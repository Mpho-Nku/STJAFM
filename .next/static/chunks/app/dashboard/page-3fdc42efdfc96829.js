(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2978:function(e,t,a){Promise.resolve().then(a.bind(a,4591))},4591:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(7437),n=a(2265),r=a(1180);function l(){let[e,t]=(0,n.useState)(null),[a,l]=(0,n.useState)("viewer");return((0,n.useEffect)(()=>{(async()=>{let{data:e}=await r.O.auth.getUser();if(t(e.user),e.user){let{data:t}=await r.O.from("profiles").select("role").eq("id",e.user.id).single();l((null==t?void 0:t.role)||"viewer")}})()},[]),e)?(0,s.jsxs)("div",{className:"grid gap-6",children:[(0,s.jsx)(o,{}),(0,s.jsx)(u,{}),(0,s.jsx)(h,{user:e,role:a}),(0,s.jsx)(d,{user:e,role:a})]}):(0,s.jsx)("div",{children:"Please sign in."})}function i(e){let{children:t}=e;return(0,s.jsx)("div",{className:"card p-4 space-y-3",children:t})}function c(e){let{label:t,...a}=e;return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"label",children:t}),(0,s.jsx)("input",{className:"input",...a})]})}function o(){let[e,t]=(0,n.useState)({name:"",pastor_name:"",street:"",area_code:"",suburb:"",township:"",description:""}),[a,l]=(0,n.useState)(null),o=async()=>{let s=null;if(a){a.name.split(".").pop();let e="".concat(Date.now(),"-").concat(a.name),t="".concat(e),{error:n}=await r.O.storage.from("church-images").upload(t,a);if(n){console.error("Image upload failed:",n.message),alert("Image upload failed: "+n.message);return}let{data:l}=r.O.storage.from("church-images").getPublicUrl(t);s=l.publicUrl}let n={...e,images:s?[s]:[]},{error:i}=await r.O.from("churches").insert(n);i?(console.error("Insert error:",i),alert("Insert failed: "+i.message)):(alert("Church created"),t({name:"",pastor_name:"",street:"",area_code:"",suburb:"",township:"",description:""}),l(null))};return(0,s.jsxs)(i,{children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Add Church"}),(0,s.jsx)(c,{label:"Name",value:e.name,onChange:a=>t({...e,name:a.target.value})}),(0,s.jsx)(c,{label:"Pastor",value:e.pastor_name,onChange:a=>t({...e,pastor_name:a.target.value})}),(0,s.jsx)(c,{label:"Street",value:e.street,onChange:a=>t({...e,street:a.target.value})}),(0,s.jsx)(c,{label:"Area Code",value:e.area_code,onChange:a=>t({...e,area_code:a.target.value})}),(0,s.jsx)(c,{label:"Suburb",value:e.suburb,onChange:a=>t({...e,suburb:a.target.value})}),(0,s.jsx)(c,{label:"Township",value:e.township,onChange:a=>t({...e,township:a.target.value})}),(0,s.jsx)(c,{label:"Description",value:e.description,onChange:a=>t({...e,description:a.target.value})}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"label",children:"Church Image"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files.length>0&&l(e.target.files[0])}})]}),(0,s.jsx)("button",{className:"btn btn-primary",onClick:o,children:"Create"})]})}function u(){let[e,t]=(0,n.useState)(""),[a,l]=(0,n.useState)([]),[o,u]=(0,n.useState)({title:"",description:"",start_time:"",end_time:"",location:""});(0,n.useEffect)(()=>{r.O.from("churches").select("id,name,street,suburb,township,area_code").then(e=>{let{data:t}=e;return l(t||[])})},[]),(0,n.useEffect)(()=>{if(e){let t=a.find(t=>t.id===e);if(t){let e="".concat(t.street||"",", ").concat(t.suburb||"",", ").concat(t.township||"",", ").concat(t.area_code||"");u(t=>({...t,location:e}))}}},[e,a]);let d=async()=>{if(!e)return alert("Select church");let{error:t}=await r.O.from("events").insert({...o,church_id:e});t?(console.error("Insert error:",t),alert("Insert failed: "+t.message)):alert("Event created")};return(0,s.jsxs)(i,{children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Add Event"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"label",children:"Church"}),(0,s.jsxs)("select",{className:"input",value:e,onChange:e=>t(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Choose"}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsx)(c,{label:"Title",value:o.title,onChange:e=>u({...o,title:e.target.value})}),(0,s.jsx)(c,{label:"Description",value:o.description,onChange:e=>u({...o,description:e.target.value})}),(0,s.jsx)(c,{label:"Start Time",type:"datetime-local",value:o.start_time,onChange:e=>u({...o,start_time:e.target.value})}),(0,s.jsx)(c,{label:"End Time",type:"datetime-local",value:o.end_time,onChange:e=>u({...o,end_time:e.target.value})}),(0,s.jsx)(c,{label:"Location",value:o.location,readOnly:!0}),(0,s.jsx)("button",{className:"btn btn-primary",onClick:d,children:"Create"})]})}function d(e){let{user:t,role:a}=e,[l,c]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!t)return;let e=r.O.from("events").select("id, title, start_time, created_by");"admin"!==a&&(e=e.eq("created_by",t.id)),e.order("created_at",{ascending:!1}).then(e=>{let{data:t}=e;return c(t||[])})},[t,a]);let o=async e=>{confirm("Delete this event?")&&(await r.O.from("events").delete().eq("id",e),c(l.filter(t=>t.id!==e)))};return(0,s.jsxs)(i,{children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Manage Events"}),0===l.length&&(0,s.jsx)("p",{className:"text-neutral-400 text-sm",children:"No events yet."}),l.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-neutral-800 py-2",children:[(0,s.jsxs)("span",{children:[e.title," (",new Date(e.start_time).toLocaleDateString(),")"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("a",{className:"btn",href:"/events/".concat(e.id,"/edit"),children:"Edit"}),(0,s.jsx)("button",{className:"btn",onClick:()=>o(e.id),children:"Delete"})]})]},e.id))]})}function h(e){let{user:t,role:a}=e,[l,c]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!t)return;let e=r.O.from("churches").select("id,name,pastor_name,created_by");"admin"!==a&&(e=e.eq("created_by",t.id)),e.order("created_at",{ascending:!1}).then(e=>{let{data:t}=e;return c(t||[])})},[t,a]);let o=async e=>{confirm("Delete this church?")&&(await r.O.from("churches").delete().eq("id",e),c(l.filter(t=>t.id!==e)))};return(0,s.jsxs)(i,{children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Manage Churches"}),0===l.length&&(0,s.jsx)("p",{className:"text-neutral-400 text-sm",children:"No churches yet."}),l.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-neutral-800 py-2",children:[(0,s.jsxs)("span",{children:[e.name," (Pastor: ",e.pastor_name||"N/A",")"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("a",{className:"btn",href:"/churches/".concat(e.id,"/edit"),children:"Edit"}),(0,s.jsx)("button",{className:"btn",onClick:()=>o(e.id),children:"Delete"})]})]},e.id))]})}},1180:function(e,t,a){"use strict";a.d(t,{O:function(){return s}});let s=(0,a(4392).createClientComponentClient)()}},function(e){e.O(0,[392,971,23,744],function(){return e(e.s=2978)}),_N_E=e.O()}]);