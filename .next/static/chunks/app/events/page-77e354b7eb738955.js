(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38],{5476:function(e,t,s){Promise.resolve().then(s.bind(s,579))},579:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var n=s(7437),r=s(7138),i=s(2265),a=s(1180),c=s(7440);function l(){let[e,t]=(0,i.useState)([]),[s,l]=(0,i.useState)(null),[o,d]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{let{data:e}=await a.O.auth.getUser();l(null==e?void 0:e.user);let{data:s,error:n}=await a.O.from("events").select("id, title, start_time, description, is_saved_by, church:church_id(name, suburb, township)").order("start_time",{ascending:!0});n?console.error("Events fetch error:",n.message):t(s||[])}catch(e){console.error("Unexpected error:",e)}finally{d(!1)}})()},[]);let u=async e=>{var n;if(!s){alert("Please login to save events");return}let r=(null===(n=e.is_saved_by)||void 0===n?void 0:n.includes(s.id))?e.is_saved_by.filter(e=>e!==s.id):[...e.is_saved_by||[],s.id],{error:i}=await a.O.from("events").update({is_saved_by:r}).eq("id",e.id);i?(console.error("Save/Unsave error:",i.message),alert("Something went wrong, please try again")):t(t=>t.map(t=>t.id===e.id?{...t,is_saved_by:r}:t))};return o?(0,n.jsx)("div",{children:"Loading events..."}):0===e.length?(0,n.jsx)("div",{className:"text-gray-500",children:"No events yet."}):(0,n.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Upcoming Events"}),(0,n.jsx)("div",{className:"grid gap-4",children:e.map(e=>{var t;let i=s&&(null===(t=e.is_saved_by)||void 0===t?void 0:t.includes(s.id));return(0,n.jsxs)("div",{className:"p-4 border border-gray-200 bg-white rounded-lg shadow-sm hover:shadow-md transition",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-blue-900",children:(0,n.jsx)(r.default,{href:"/events/".concat(e.id),children:e.title})}),(0,n.jsx)("div",{className:"text-sm text-blue-600",children:(0,c.G)(e.start_time)}),(0,n.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.description||"No description"}),e.church&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[e.church.name," â€“ ",e.church.suburb,", ",e.church.township]}),(0,n.jsx)("div",{className:"mt-3",children:s?(0,n.jsx)("button",{className:"btn ".concat(i?"bg-gray-300 text-black":"btn-primary"),onClick:()=>u(e),children:i?"Unsave":"Save"}):(0,n.jsx)("button",{className:"btn btn-primary",onClick:()=>alert("Please login to save events"),children:"Login to Save"})})]},e.id)})})]})}},1180:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});let n=(0,s(4392).createClientComponentClient)()},7440:function(e,t,s){"use strict";function n(e){return("string"==typeof e?new Date(e):e).toLocaleString()}s.d(t,{G:function(){return n}})}},function(e){e.O(0,[392,138,971,23,744],function(){return e(e.s=5476)}),_N_E=e.O()}]);